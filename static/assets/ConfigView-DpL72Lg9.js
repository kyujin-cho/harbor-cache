import{c as r,a as s,o as l,d as ee,j as te,f as b,g as v,b as C,m as S,n as V,e as _,t as p,l as L,F,G as se,s as R,h as k,v as T,p as O,H as B,I as ae,A as D}from"./index-CQZJkS29.js";import{r as I}from"./ArrowPathIcon-DlvPnKNn.js";import{r as q}from"./ExclamationTriangleIcon-DM2XedPL.js";function oe(z,m){return l(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})])}function ne(z,m){return l(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])}const le={class:"p-8"},re={class:"mb-8 flex items-center justify-between"},ie=["disabled"],ue={key:0,class:"mb-6 rounded-md bg-red-50 p-4"},ce={class:"text-sm text-red-700"},de={key:1,class:"mb-6 rounded-md bg-green-50 p-4"},ve={class:"text-sm text-green-700"},pe={class:"flex items-center gap-2"},me={key:3,class:"flex items-center justify-center h-64"},fe={class:"flex border-b border-gray-200 mb-6"},ye={key:0,class:"flex gap-6"},he={class:"w-48 flex-shrink-0"},ge={class:"space-y-1"},xe=["onClick"],_e={class:"flex-1"},be={class:"card"},ke={class:"mb-6"},we={class:"text-lg font-semibold text-gray-900"},Ce={class:"text-sm text-gray-500"},Ve={class:"space-y-6"},$e={class:"label"},Se={key:0,class:"text-red-500"},Fe={class:"text-xs text-gray-500 mb-1"},Be=["onUpdate:modelValue"],Me=["value"],Ue=["onUpdate:modelValue"],je=["onUpdate:modelValue","placeholder"],Ne={key:3,class:"relative"},Re=["onUpdate:modelValue","placeholder"],Te={key:0,class:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-gray-500"},He=["onUpdate:modelValue","placeholder"],Ae={key:1,class:"card"},We={class:"mt-6 flex items-center justify-between"},qe={class:"flex items-center gap-2"},ze={key:0,class:"text-sm text-yellow-600 flex items-center gap-1"},Ee={class:"flex gap-3"},Ge=["disabled"],Ke=["disabled"],Le={class:"mt-6 rounded-md bg-blue-50 p-4"},Oe={class:"flex items-start gap-3"},Ye=ee({__name:"ConfigView",setup(z){const m=v(null),g=v(""),M=v(""),$=v(!0),U=v(!1),j=v(!1),f=v(""),N=v(""),x=v(null),y=v("form"),H=v("server"),u=v({});async function P(){var n,e,o,t;try{const a=await B.getSchema();m.value=a.data}catch(a){f.value=((t=(o=(e=(n=a.response)==null?void 0:n.data)==null?void 0:e.errors)==null?void 0:o[0])==null?void 0:t.message)||"Failed to fetch config schema"}}async function Y(){var n,e,o,t;try{const a=await B.getFile();g.value=a.data.content,M.value=a.data.content,E(a.data.content)}catch(a){f.value=((t=(o=(e=(n=a.response)==null?void 0:n.data)==null?void 0:e.errors)==null?void 0:o[0])==null?void 0:t.message)||"Failed to fetch config file"}}function E(n){const e=n.split(`
`);let o="",t="";for(const a of e){const i=a.trim(),h=i.match(/^\[([^\]]+)\]$/);if(h){const d=h[1].split(".");o=d[0],t=d.length>1?d[1]:"";continue}const w=i.match(/^([a-z_]+)\s*=\s*(.+)$/);if(w){let d=o;t&&(d+="."+t),d+="."+w[1];let c=w[2].trim();(c.startsWith('"')&&c.endsWith('"')||c.startsWith("'")&&c.endsWith("'"))&&(c=c.slice(1,-1)),u.value[d]=c}}}function A(){if(!m.value)return g.value;const n={};for(const t of m.value.fields){const a=t.key.split("."),i=a.length>2?`${a[0]}.${a[1]}`:a[0];n[i]||(n[i]=[]),n[i].push(t)}let e=`# Harbor Cache Configuration

`;const o=new Set;for(const[t,a]of Object.entries(n)){const i=t.split("."),h=i[0],w=i.length>1?i[1]:null;w?e+=`[${h}.${w}]
`:o.has(h)||(e+=`[${h}]
`,o.add(h));for(const d of a){const c=u.value[d.key];if(c!==void 0&&c!==""){const W=d.key.split(".").pop();d.field_type==="number"?e+=`${W} = ${c}
`:d.field_type==="boolean"?e+=`${W} = ${c}
`:e+=`${W} = "${c}"
`}}e+=`
`}return e.trim()+`
`}async function G(){$.value=!0,f.value="",await Promise.all([P(),Y()]),$.value=!1}async function Z(){var e,o,t,a;j.value=!0,x.value=null,f.value="";const n=y.value==="form"?A():g.value;try{const i=await B.validate(n);x.value=i.data}catch(i){f.value=((a=(t=(o=(e=i.response)==null?void 0:e.data)==null?void 0:o.errors)==null?void 0:t[0])==null?void 0:a.message)||"Validation failed"}finally{j.value=!1}}async function J(){var e,o,t,a;U.value=!0,f.value="",N.value="",x.value=null;const n=y.value==="form"?A():g.value;try{const i=await B.validate(n);if(!i.data.valid){f.value=i.data.message;return}const h=await B.updateFile(n);N.value=h.data.message,M.value=n,g.value=n,y.value==="raw"&&E(n)}catch(i){f.value=((a=(t=(o=(e=i.response)==null?void 0:e.data)==null?void 0:o.errors)==null?void 0:t[0])==null?void 0:a.message)||"Save failed"}finally{U.value=!1}}const K=O(()=>y.value==="raw"?g.value!==M.value:A()!==M.value),Q=O(()=>{if(!m.value)return{};const n={};for(const e of m.value.fields)n[e.group]||(n[e.group]=[]),n[e.group].push(e);return n});function X(n){const e=["B","KB","MB","GB","TB"];let o=0,t=n;for(;t>=1024&&o<e.length-1;)t/=1024,o++;return`${t.toFixed(t>=100?0:1)} ${e[o]}`}return te(G),(n,e)=>(l(),r("div",le,[s("div",re,[e[4]||(e[4]=s("div",null,[s("h1",{class:"text-2xl font-bold text-gray-900"},"Configuration"),s("p",{class:"mt-1 text-sm text-gray-500"},"Manage server configuration settings")],-1)),s("button",{onClick:G,disabled:$.value,class:"btn btn-secondary flex items-center gap-2"},[C(_(I),{class:V(["h-4 w-4",{"animate-spin":$.value}])},null,8,["class"]),e[3]||(e[3]=S(" Refresh ",-1))],8,ie)]),f.value?(l(),r("div",ue,[s("p",ce,p(f.value),1)])):b("",!0),N.value?(l(),r("div",de,[s("p",ve,p(N.value),1)])):b("",!0),x.value?(l(),r("div",{key:2,class:V(["mb-6 rounded-md p-4",x.value.valid?"bg-green-50":"bg-yellow-50"])},[s("div",pe,[x.value.valid?(l(),L(_(oe),{key:0,class:"h-5 w-5 text-green-600"})):(l(),L(_(q),{key:1,class:"h-5 w-5 text-yellow-600"})),s("p",{class:V(["text-sm",x.value.valid?"text-green-700":"text-yellow-700"])},p(x.value.message),3)])],2)):b("",!0),$.value?(l(),r("div",me,[C(_(I),{class:"h-8 w-8 text-gray-400 animate-spin"})])):m.value?(l(),r(F,{key:4},[s("div",fe,[s("button",{onClick:e[0]||(e[0]=o=>y.value="form"),class:V(["px-4 py-2 text-sm font-medium border-b-2 -mb-px flex items-center gap-2",y.value==="form"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"])},[C(_(se),{class:"h-4 w-4"}),e[5]||(e[5]=S(" Form Editor ",-1))],2),s("button",{onClick:e[1]||(e[1]=o=>y.value="raw"),class:V(["px-4 py-2 text-sm font-medium border-b-2 -mb-px flex items-center gap-2",y.value==="raw"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"])},[C(_(ne),{class:"h-4 w-4"}),e[6]||(e[6]=S(" Raw TOML ",-1))],2)]),y.value==="form"?(l(),r("div",ye,[s("div",he,[s("nav",ge,[(l(!0),r(F,null,R(m.value.groups,o=>(l(),r("button",{key:o.id,onClick:t=>H.value=o.id,class:V(["w-full text-left px-3 py-2 text-sm rounded-md transition-colors",H.value===o.id?"bg-primary-100 text-primary-700 font-medium":"text-gray-600 hover:bg-gray-100"])},p(o.label),11,xe))),128))])]),s("div",_e,[(l(!0),r(F,null,R(m.value.groups,o=>k((l(),r("div",{key:o.id},[s("div",be,[s("div",ke,[s("h2",we,p(o.label),1),s("p",Ce,p(o.description),1)]),s("div",Ve,[(l(!0),r(F,null,R(Q.value[o.id],t=>(l(),r("div",{key:t.key},[s("label",$e,[S(p(t.label)+" ",1),t.required?(l(),r("span",Se,"*")):b("",!0)]),s("p",Fe,p(t.description),1),t.field_type==="select"&&t.options?k((l(),r("select",{key:0,"onUpdate:modelValue":a=>u.value[t.key]=a,class:"input"},[e[7]||(e[7]=s("option",{value:""},"Select...",-1)),(l(!0),r(F,null,R(t.options,a=>(l(),r("option",{key:a.value,value:a.value},p(a.label),9,Me))),128))],8,Be)),[[D,u.value[t.key]]]):t.field_type==="boolean"?k((l(),r("select",{key:1,"onUpdate:modelValue":a=>u.value[t.key]=a,class:"input"},[...e[8]||(e[8]=[s("option",{value:"true"},"Yes",-1),s("option",{value:"false"},"No",-1)])],8,Ue)),[[D,u.value[t.key]]]):t.field_type==="password"?k((l(),r("input",{key:2,"onUpdate:modelValue":a=>u.value[t.key]=a,type:"password",class:"input",placeholder:t.default_value||""},null,8,je)),[[T,u.value[t.key]]]):t.field_type==="number"?(l(),r("div",Ne,[k(s("input",{"onUpdate:modelValue":a=>u.value[t.key]=a,type:"number",class:"input",placeholder:t.default_value||""},null,8,Re),[[T,u.value[t.key]]]),t.key==="cache.max_size"&&u.value[t.key]?(l(),r("span",Te,p(X(Number(u.value[t.key]))),1)):b("",!0)])):k((l(),r("input",{key:4,"onUpdate:modelValue":a=>u.value[t.key]=a,type:"text",class:"input",placeholder:t.default_value||""},null,8,He)),[[T,u.value[t.key]]])]))),128))])])])),[[ae,H.value===o.id]])),128))])])):(l(),r("div",Ae,[e[9]||(e[9]=s("div",{class:"mb-4"},[s("h2",{class:"text-lg font-semibold text-gray-900"},"Raw Configuration (TOML)"),s("p",{class:"text-sm text-gray-500"},"Edit the configuration file directly")],-1)),k(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=o=>g.value=o),class:"w-full h-96 font-mono text-sm p-4 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500",placeholder:"# Configuration content..."},null,512),[[T,g.value]])])),s("div",We,[s("div",qe,[K.value?(l(),r("span",ze,[C(_(q),{class:"h-4 w-4"}),e[10]||(e[10]=S(" Unsaved changes ",-1))])):b("",!0)]),s("div",Ee,[s("button",{onClick:Z,disabled:j.value,class:"btn btn-secondary"},p(j.value?"Validating...":"Validate"),9,Ge),s("button",{onClick:J,disabled:U.value||!K.value,class:"btn btn-primary"},p(U.value?"Saving...":"Save Changes"),9,Ke)])]),s("div",Le,[s("div",Oe,[C(_(q),{class:"h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5"}),e[11]||(e[11]=s("div",null,[s("p",{class:"text-sm font-medium text-blue-800"},"Server Restart Required"),s("p",{class:"text-sm text-blue-700 mt-1"}," Most configuration changes require a server restart to take effect. After saving, restart the Harbor Cache server to apply the new settings. ")],-1))])])],64)):b("",!0)]))}});export{Ye as default};
