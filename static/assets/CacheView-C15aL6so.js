import{c as o,a as e,o as n,d as ne,u as ie,z as re,j as de,f as x,g as u,b as v,m as Z,n as M,e as c,t as l,F as D,p as G,s as B,h as E,A as L,v as ue,x as _}from"./index-IIFH34Dd.js";import{r as P}from"./ArrowPathIcon-oPnaH1Jj.js";import{r as ce,a as pe,b as xe}from"./FunnelIcon-B_rgCtX7.js";import{r as ve}from"./ClockIcon-CJmKLPaO.js";import{r as I}from"./TrashIcon-C3NpBTHa.js";import{r as J}from"./ExclamationTriangleIcon-B-4XEbHW.js";function ye(K,w){return n(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}const me={class:"p-8"},ge={class:"mb-8 flex items-center justify-between"},fe=["disabled"],be={key:0,class:"mb-6 rounded-md bg-red-50 p-4"},_e={class:"text-sm text-red-700"},he={key:1,class:"mb-6 rounded-md bg-green-50 p-4"},we={class:"text-sm text-green-700"},Ce={key:2,class:"flex items-center justify-center h-64"},ke={class:"card mb-6"},Ae={class:"grid grid-cols-2 md:grid-cols-5 gap-4"},De={class:"text-xl font-bold text-gray-900"},$e={class:"text-xl font-bold text-gray-900"},Se={class:"text-xl font-bold text-gray-900"},je={class:"text-xl font-bold text-gray-900"},ze={class:"text-xl font-bold text-green-600"},Ee={key:0,class:"card mb-6"},Fe={class:"overflow-x-auto"},Re={class:"min-w-full divide-y divide-gray-200"},Te={class:"bg-white divide-y divide-gray-200"},Ve={class:"px-4 py-2 whitespace-nowrap"},Me={class:"px-4 py-2 whitespace-nowrap text-sm text-gray-700"},Be={class:"px-4 py-2 whitespace-nowrap text-sm font-mono text-gray-500"},Le={class:"px-4 py-2 whitespace-nowrap text-sm text-gray-700"},Pe={class:"px-4 py-2 whitespace-nowrap text-sm font-bold text-gray-900"},Ne={class:"card mb-6"},Ue={class:"flex items-center justify-between mb-4"},qe={key:0,class:"bg-gray-50 rounded-lg p-4 mb-4"},He={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Ze=["value"],Ge={class:"relative"},Ie={key:1,class:"flex items-center justify-center h-32"},Je={class:"overflow-x-auto"},Ke={class:"min-w-full divide-y divide-gray-200"},Oe={class:"bg-gray-50"},Qe={key:0,class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase"},We={class:"bg-white divide-y divide-gray-200"},Xe={class:"px-4 py-3 whitespace-nowrap"},Ye={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-700"},et={class:"px-4 py-3 whitespace-nowrap"},tt=["title"],st={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-700"},at={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-500"},lt={class:"px-4 py-3 whitespace-nowrap text-sm text-gray-700"},ot={key:0,class:"px-4 py-3 whitespace-nowrap text-right"},nt=["onClick"],it={key:0},rt=["colspan"],dt={key:0,class:"flex items-center justify-between mt-4 pt-4 border-t"},ut={class:"text-sm text-gray-500"},ct={class:"flex items-center gap-2"},pt=["disabled"],xt={class:"text-sm text-gray-700"},vt=["disabled"],yt={key:1,class:"card"},mt={class:"space-y-4"},gt={class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg"},ft={class:"flex items-center gap-3"},bt={class:"p-2 bg-blue-100 rounded-lg"},_t=["disabled"],ht={class:"flex items-center justify-between p-4 bg-red-50 rounded-lg"},wt={class:"flex items-center gap-3"},Ct={class:"p-2 bg-red-100 rounded-lg"},kt=["disabled"],At={key:4,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Dt={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},$t={class:"flex items-center gap-3 mb-4"},St={class:"p-2 bg-red-100 rounded-full"},jt={class:"flex justify-end gap-3"},zt={key:5,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Et={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},Ft={class:"flex items-center gap-3 mb-4"},Rt={class:"p-2 bg-red-100 rounded-full"},Tt={class:"text-sm font-mono text-gray-500 bg-gray-100 p-2 rounded mb-6 break-all"},Vt={class:"flex justify-end gap-3"},Mt=["disabled"],Ht=ne({__name:"CacheView",setup(K){const w=ie(),g=u(null),F=u([]),R=u([]),N=u([]),C=u(!0),T=u(!1),y=u(!1),m=u(""),f=u(""),$=u(!1),S=u(!1),b=u(null),p=u(1),h=u(20),j=u(0),r=u({entry_type:"",repository:"",digest:"",sort_by:"last_accessed_at",sort_order:"desc"}),V=u(!1),z=G(()=>Math.ceil(j.value/h.value));async function O(){var a,t,d,s;try{const i=await _.getStats();g.value=i.data}catch(i){m.value=((s=(d=(t=(a=i.response)==null?void 0:a.data)==null?void 0:t.errors)==null?void 0:d[0])==null?void 0:s.message)||"Failed to fetch stats"}}async function k(){var a,t,d,s;T.value=!0;try{const i={offset:(p.value-1)*h.value,limit:h.value,sort_by:r.value.sort_by,sort_order:r.value.sort_order};r.value.entry_type&&(i.entry_type=r.value.entry_type),r.value.repository&&(i.repository=r.value.repository),r.value.digest&&(i.digest=r.value.digest);const H=await _.getEntries(i);F.value=H.data.entries,j.value=H.data.total}catch(i){m.value=((s=(d=(t=(a=i.response)==null?void 0:a.data)==null?void 0:t.errors)==null?void 0:d[0])==null?void 0:s.message)||"Failed to fetch entries"}finally{T.value=!1}}async function Q(){try{const a=await _.getTopAccessed();R.value=a.data}catch(a){console.error("Failed to fetch top accessed:",a)}}async function W(){try{const a=await _.getRepositories();N.value=a.data.repositories}catch(a){console.error("Failed to fetch repositories:",a)}}async function A(){C.value=!0,m.value="",await Promise.all([O(),k(),Q(),W()]),C.value=!1}async function X(){var a,t,d,s;y.value=!0,m.value="",f.value="";try{const i=await _.cleanup();f.value=`Cleaned up ${i.data.cleaned} expired entries`,await A()}catch(i){m.value=((s=(d=(t=(a=i.response)==null?void 0:a.data)==null?void 0:t.errors)==null?void 0:d[0])==null?void 0:s.message)||"Cleanup failed"}finally{y.value=!1}}async function Y(){var a,t,d,s;y.value=!0,m.value="",f.value="",$.value=!1;try{const i=await _.clear();f.value=`Cleared ${i.data.cleared} entries from cache`,await A()}catch(i){m.value=((s=(d=(t=(a=i.response)==null?void 0:a.data)==null?void 0:t.errors)==null?void 0:d[0])==null?void 0:s.message)||"Clear failed"}finally{y.value=!1}}function ee(a){b.value=a,S.value=!0}async function te(){var a,t,d,s;if(b.value){y.value=!0,m.value="",f.value="";try{await _.deleteEntry(b.value.digest),f.value=`Deleted cache entry: ${b.value.digest.substring(0,20)}...`,S.value=!1,b.value=null,await A()}catch(i){m.value=((s=(d=(t=(a=i.response)==null?void 0:a.data)==null?void 0:t.errors)==null?void 0:d[0])==null?void 0:s.message)||"Delete failed"}finally{y.value=!1}}}function se(){p.value=1,k()}function ae(){r.value={entry_type:"",repository:"",digest:"",sort_by:"last_accessed_at",sort_order:"desc"},p.value=1,k()}function U(a){a>=1&&a<=z.value&&(p.value=a,k())}function le(a){return new Date(a).toLocaleString()}function q(a){return a.length>25?a.substring(0,25)+"...":a}const oe=G(()=>g.value?(g.value.hit_rate*100).toFixed(1):"0.0");return re(()=>h.value,()=>{p.value=1,k()}),de(A),(a,t)=>{var d;return n(),o("div",me,[e("div",ge,[t[11]||(t[11]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"Cache Management"),e("p",{class:"mt-1 text-sm text-gray-500"},"View and manage cached artifacts")],-1)),e("button",{onClick:A,disabled:C.value,class:"btn btn-secondary flex items-center gap-2"},[v(c(P),{class:M(["h-4 w-4",{"animate-spin":C.value}])},null,8,["class"]),t[10]||(t[10]=Z(" Refresh ",-1))],8,fe)]),m.value?(n(),o("div",be,[e("p",_e,l(m.value),1)])):x("",!0),f.value?(n(),o("div",he,[e("p",we,l(f.value),1)])):x("",!0),C.value?(n(),o("div",Ce,[v(c(P),{class:"h-8 w-8 text-gray-400 animate-spin"})])):g.value?(n(),o(D,{key:3},[e("div",ke,[t[17]||(t[17]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Cache Statistics",-1)),e("div",Ae,[e("div",null,[t[12]||(t[12]=e("p",{class:"text-sm text-gray-500"},"Total Size",-1)),e("p",De,l(g.value.total_size_human),1)]),e("div",null,[t[13]||(t[13]=e("p",{class:"text-sm text-gray-500"},"Total Entries",-1)),e("p",$e,l(g.value.entry_count),1)]),e("div",null,[t[14]||(t[14]=e("p",{class:"text-sm text-gray-500"},"Manifests",-1)),e("p",Se,l(g.value.manifest_count),1)]),e("div",null,[t[15]||(t[15]=e("p",{class:"text-sm text-gray-500"},"Blobs",-1)),e("p",je,l(g.value.blob_count),1)]),e("div",null,[t[16]||(t[16]=e("p",{class:"text-sm text-gray-500"},"Hit Rate",-1)),e("p",ze,l(oe.value)+"%",1)])])]),R.value.length>0?(n(),o("div",Ee,[t[19]||(t[19]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Most Frequently Accessed",-1)),e("div",Fe,[e("table",Re,[t[18]||(t[18]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Type"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Repository"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Digest"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Size"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Access Count")])],-1)),e("tbody",Te,[(n(!0),o(D,null,B(R.value.slice(0,5),s=>(n(),o("tr",{key:s.id},[e("td",Ve,[e("span",{class:M(["px-2 py-1 text-xs font-medium rounded-full",s.entry_type==="manifest"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"])},l(s.entry_type),3)]),e("td",Me,l(s.repository||"-"),1),e("td",Be,l(q(s.digest)),1),e("td",Le,l(s.size_human),1),e("td",Pe,l(s.access_count),1)]))),128))])])])])):x("",!0),e("div",Ne,[e("div",Ue,[t[21]||(t[21]=e("h2",{class:"text-lg font-semibold text-gray-900"},"Cached Entries",-1)),e("button",{onClick:t[0]||(t[0]=s=>V.value=!V.value),class:"btn btn-secondary flex items-center gap-2 text-sm"},[v(c(ce),{class:"h-4 w-4"}),t[20]||(t[20]=Z(" Filters ",-1))])]),V.value?(n(),o("div",qe,[e("div",He,[e("div",null,[t[23]||(t[23]=e("label",{class:"label"},"Type",-1)),E(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>r.value.entry_type=s),class:"input text-sm"},[...t[22]||(t[22]=[e("option",{value:""},"All",-1),e("option",{value:"manifest"},"Manifest",-1),e("option",{value:"blob"},"Blob",-1)])],512),[[L,r.value.entry_type]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"label"},"Repository",-1)),E(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>r.value.repository=s),class:"input text-sm"},[t[24]||(t[24]=e("option",{value:""},"All",-1)),(n(!0),o(D,null,B(N.value,s=>(n(),o("option",{key:s,value:s},l(s),9,Ze))),128))],512),[[L,r.value.repository]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"label"},"Digest (contains)",-1)),e("div",Ge,[v(c(ye),{class:"h-4 w-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),E(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>r.value.digest=s),type:"text",placeholder:"Search digest...",class:"input text-sm pl-9"},null,512),[[ue,r.value.digest]])])]),e("div",null,[t[28]||(t[28]=e("label",{class:"label"},"Sort By",-1)),E(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>r.value.sort_by=s),class:"input text-sm"},[...t[27]||(t[27]=[e("option",{value:"last_accessed_at"},"Last Accessed",-1),e("option",{value:"created_at"},"Created",-1),e("option",{value:"size"},"Size",-1),e("option",{value:"access_count"},"Access Count",-1)])],512),[[L,r.value.sort_by]])])]),e("div",{class:"flex justify-end gap-2 mt-4"},[e("button",{onClick:ae,class:"btn btn-secondary text-sm"},"Clear"),e("button",{onClick:se,class:"btn btn-primary text-sm"},"Apply")])])):x("",!0),T.value?(n(),o("div",Ie,[v(c(P),{class:"h-6 w-6 text-gray-400 animate-spin"})])):(n(),o(D,{key:2},[e("div",Je,[e("table",Ke,[e("thead",Oe,[e("tr",null,[t[29]||(t[29]=e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Type",-1)),t[30]||(t[30]=e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Repository",-1)),t[31]||(t[31]=e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Digest",-1)),t[32]||(t[32]=e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Size",-1)),t[33]||(t[33]=e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Last Accessed",-1)),t[34]||(t[34]=e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Accesses",-1)),c(w).isAdmin?(n(),o("th",Qe,"Actions")):x("",!0)])]),e("tbody",We,[(n(!0),o(D,null,B(F.value,s=>(n(),o("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",Xe,[e("span",{class:M(["px-2 py-1 text-xs font-medium rounded-full",s.entry_type==="manifest"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"])},l(s.entry_type),3)]),e("td",Ye,l(s.repository||"-"),1),e("td",et,[e("span",{class:"text-xs font-mono text-gray-500",title:s.digest},l(q(s.digest)),9,tt)]),e("td",st,l(s.size_human),1),e("td",at,l(le(s.last_accessed_at)),1),e("td",lt,l(s.access_count),1),c(w).isAdmin?(n(),o("td",ot,[e("button",{onClick:i=>ee(s),class:"text-red-600 hover:text-red-900",title:"Delete entry"},[v(c(I),{class:"h-4 w-4"})],8,nt)])):x("",!0)]))),128)),F.value.length===0?(n(),o("tr",it,[e("td",{colspan:c(w).isAdmin?7:6,class:"px-4 py-12 text-center text-gray-500"}," No cache entries found ",8,rt)])):x("",!0)])])]),z.value>1?(n(),o("div",dt,[e("div",ut," Showing "+l((p.value-1)*h.value+1)+" to "+l(Math.min(p.value*h.value,j.value))+" of "+l(j.value)+" entries ",1),e("div",ct,[e("button",{onClick:t[5]||(t[5]=s=>U(p.value-1)),disabled:p.value===1,class:"btn btn-secondary p-2"},[v(c(pe),{class:"h-4 w-4"})],8,pt),e("span",xt,"Page "+l(p.value)+" of "+l(z.value),1),e("button",{onClick:t[6]||(t[6]=s=>U(p.value+1)),disabled:p.value===z.value,class:"btn btn-secondary p-2"},[v(c(xe),{class:"h-4 w-4"})],8,vt)])])):x("",!0)],64))]),c(w).isAdmin?(n(),o("div",yt,[t[37]||(t[37]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Cache Actions",-1)),e("div",mt,[e("div",gt,[e("div",ft,[e("div",bt,[v(c(ve),{class:"h-6 w-6 text-blue-600"})]),t[35]||(t[35]=e("div",null,[e("p",{class:"font-medium text-gray-900"},"Cleanup Expired Entries"),e("p",{class:"text-sm text-gray-500"},"Remove entries older than the retention period")],-1))]),e("button",{onClick:X,disabled:y.value,class:"btn btn-secondary"},l(y.value?"Running...":"Run Cleanup"),9,_t)]),e("div",ht,[e("div",wt,[e("div",Ct,[v(c(I),{class:"h-6 w-6 text-red-600"})]),t[36]||(t[36]=e("div",null,[e("p",{class:"font-medium text-gray-900"},"Clear All Cache"),e("p",{class:"text-sm text-gray-500"},"Remove all cached entries (this cannot be undone)")],-1))]),e("button",{onClick:t[7]||(t[7]=s=>$.value=!0),disabled:y.value,class:"btn btn-danger"}," Clear Cache ",8,kt)])])])):x("",!0)],64)):x("",!0),$.value?(n(),o("div",At,[e("div",Dt,[e("div",$t,[e("div",St,[v(c(J),{class:"h-6 w-6 text-red-600"})]),t[38]||(t[38]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Clear All Cache?",-1))]),t[39]||(t[39]=e("p",{class:"text-gray-600 mb-6"}," This will remove all cached manifests and blobs. This action cannot be undone. ",-1)),e("div",jt,[e("button",{onClick:t[8]||(t[8]=s=>$.value=!1),class:"btn btn-secondary"}," Cancel "),e("button",{onClick:Y,class:"btn btn-danger"}," Clear All ")])])])):x("",!0),S.value?(n(),o("div",zt,[e("div",Et,[e("div",Ft,[e("div",Rt,[v(c(J),{class:"h-6 w-6 text-red-600"})]),t[40]||(t[40]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Delete Cache Entry?",-1))]),t[41]||(t[41]=e("p",{class:"text-gray-600 mb-2"}," Are you sure you want to delete this cache entry? ",-1)),e("p",Tt,l((d=b.value)==null?void 0:d.digest),1),e("div",Vt,[e("button",{onClick:t[9]||(t[9]=s=>{S.value=!1,b.value=null}),class:"btn btn-secondary"}," Cancel "),e("button",{onClick:te,disabled:y.value,class:"btn btn-danger"},l(y.value?"Deleting...":"Delete"),9,Mt)])])])):x("",!0)])}}});export{Ht as default};
