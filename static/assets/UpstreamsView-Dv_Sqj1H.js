import{c as r,a as t,o as n,d as G,j as J,f,l as R,g as c,m as b,t as d,b as m,n as h,e as u,F as S,s as E,w as K,h as p,v as _,A as Q,C as T,T as W,D as w,E as X}from"./index-LlC-mSnx.js";import{r as F}from"./ArrowPathIcon-CuEPsUyF.js";import{r as N,a as Y}from"./PlusIcon-DAifHnRR.js";import{r as ee}from"./TrashIcon-DaJaQyEA.js";function te(C,v){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.75 3.104v5.714a2.25 2.25 0 0 1-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 0 1 4.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0 1 12 15a9.065 9.065 0 0 0-6.23-.693L5 14.5m14.8.8 1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0 1 12 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5"})])}function se(C,v){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function le(C,v){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"})])}function P(C,v){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.75 17.25v-.228a4.5 4.5 0 0 0-.12-1.03l-2.268-9.64a3.375 3.375 0 0 0-3.285-2.602H7.923a3.375 3.375 0 0 0-3.285 2.602l-2.268 9.64a4.5 4.5 0 0 0-.12 1.03v.228m19.5 0a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3m19.5 0a3 3 0 0 0-3-3H5.25a3 3 0 0 0-3 3m16.5 0h.008v.008h-.008v-.008Zm-3 0h.008v.008h-.008v-.008Z"})])}function ae(C,v){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}const ne={class:"p-8"},oe={class:"mb-8 flex items-center justify-between"},re={key:0,class:"mt-1 text-xs text-blue-600"},ie={class:"font-mono bg-blue-50 px-1 rounded"},de={class:"flex items-center gap-3"},ue=["disabled"],ce={key:0,class:"mb-6 rounded-md bg-red-50 p-4"},pe={class:"text-sm text-red-700"},me={key:1,class:"flex items-center justify-center h-64"},ve={key:2,class:"text-center py-12"},ye={class:"mt-6"},ge={key:3,class:"grid gap-6 md:grid-cols-2 lg:grid-cols-3"},xe={class:"flex items-start justify-between mb-4"},fe={class:"flex items-center gap-3"},be={class:"font-semibold text-gray-900"},he={class:"text-xs text-gray-500 font-mono"},_e={class:"space-y-2 text-sm"},we={class:"flex items-center gap-2 text-gray-600"},ke={class:"truncate"},Ce={key:0,class:"space-y-1"},Me={class:"flex flex-wrap gap-1"},Ue=["title"],Ve={key:1,class:"flex items-center gap-2"},je={class:"font-mono text-gray-700"},$e={class:"flex items-center gap-2"},Ae={class:"text-gray-700"},De={class:"flex flex-wrap gap-2 mt-3"},Be={key:0,class:"px-2 py-0.5 text-xs rounded-full bg-yellow-100 text-yellow-700"},Te={class:"px-2 py-0.5 text-xs rounded-full bg-blue-100 text-blue-700"},He={key:1,class:"px-2 py-0.5 text-xs rounded-full bg-purple-100 text-purple-700"},Le={class:"mt-4 pt-4 border-t flex justify-end gap-2"},Re=["onClick"],Se=["onClick"],Ee={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},Fe={class:"flex min-h-screen items-center justify-center p-4"},Ne={class:"relative bg-white rounded-lg shadow-xl max-w-lg w-full p-6"},Pe={class:"text-lg font-semibold mb-4"},qe={key:0},Ze={class:"grid grid-cols-2 gap-4"},ze=["placeholder"],Ie=["placeholder"],Oe={class:"grid grid-cols-2 gap-4"},Ge={class:"flex flex-wrap gap-4"},Je={class:"flex items-center gap-2"},Ke={class:"flex items-center gap-2"},Qe={class:"flex items-center gap-2"},We={class:"pt-4 border-t"},Xe=["disabled"],Ye={class:"flex justify-end gap-3 pt-4"},et={type:"submit",class:"btn btn-primary"},nt=G({__name:"UpstreamsView",setup(C){const v=c([]),A=c(new Map),M=c(!0),k=c(""),D=c(null),V=c(!1),x=c("create"),U=c(null),l=c({name:"",display_name:"",url:"",registry:"",username:"",password:"",skip_tls_verify:!1,priority:100,enabled:!0,cache_isolation:"shared",is_default:!1,routes:[]}),j=c(!1),y=c(null);async function $(){var a,e,s,i;try{M.value=!0,k.value="";const o=await w.list();v.value=o.data;try{const g=await w.getAllHealth();A.value=new Map(g.data.map(L=>[L.name,L]))}catch(g){console.error("Failed to fetch health status:",g)}try{const g=await w.getConfigPath();D.value=g.data.path}catch(g){console.error("Failed to fetch config path:",g)}}catch(o){k.value=((i=(s=(e=(a=o.response)==null?void 0:a.data)==null?void 0:e.errors)==null?void 0:s[0])==null?void 0:i.message)||"Failed to fetch upstreams"}finally{M.value=!1}}function H(){x.value="create",U.value=null,l.value={name:"",display_name:"",url:"",registry:"",username:"",password:"",skip_tls_verify:!1,priority:100,enabled:!0,cache_isolation:"shared",is_default:!1,routes:[]},y.value=null,V.value=!0}function q(a){x.value="edit",U.value=a,l.value={name:a.name,display_name:a.display_name,url:a.url,registry:a.registry,username:"",password:"",skip_tls_verify:a.skip_tls_verify,priority:a.priority,enabled:a.enabled,cache_isolation:a.cache_isolation,is_default:a.is_default,routes:[]},y.value=null,V.value=!0}function B(){V.value=!1,U.value=null,y.value=null}async function Z(){var a,e,s,i;j.value=!0,y.value=null;try{const o=await w.test({url:l.value.url,registry:l.value.registry,username:l.value.username||void 0,password:l.value.password||void 0,skip_tls_verify:l.value.skip_tls_verify});y.value=o.data}catch(o){y.value={success:!1,message:((i=(s=(e=(a=o.response)==null?void 0:a.data)==null?void 0:e.errors)==null?void 0:s[0])==null?void 0:i.message)||"Test failed"}}finally{j.value=!1}}async function z(){var a,e,s,i;try{if(x.value==="create")await w.create(l.value);else if(U.value){const o={display_name:l.value.display_name,url:l.value.url,registry:l.value.registry,skip_tls_verify:l.value.skip_tls_verify,priority:l.value.priority,enabled:l.value.enabled,cache_isolation:l.value.cache_isolation,is_default:l.value.is_default};l.value.username&&(o.username=l.value.username),l.value.password&&(o.password=l.value.password),await w.update(U.value.name,o)}B(),$()}catch(o){k.value=((i=(s=(e=(a=o.response)==null?void 0:a.data)==null?void 0:e.errors)==null?void 0:s[0])==null?void 0:i.message)||"Failed to save upstream"}}async function I(a){var e,s,i,o;if(confirm(`Are you sure you want to delete upstream "${a.display_name}"? This will update the config file.`))try{await w.delete(a.name),$()}catch(g){k.value=((o=(i=(s=(e=g.response)==null?void 0:e.data)==null?void 0:s.errors)==null?void 0:i[0])==null?void 0:o.message)||"Failed to delete upstream"}}function O(a){const e=A.value.get(a);return e?e.healthy?"text-green-500":"text-red-500":"text-gray-400"}return J($),(a,e)=>(n(),r("div",ne,[t("div",oe,[t("div",null,[e[12]||(e[12]=t("h1",{class:"text-2xl font-bold text-gray-900"},"Upstreams",-1)),e[13]||(e[13]=t("p",{class:"mt-1 text-sm text-gray-500"},"Manage upstream Harbor registries",-1)),D.value?(n(),r("p",re,[e[11]||(e[11]=b(" Changes are persisted to: ",-1)),t("code",ie,d(D.value),1)])):f("",!0)]),t("div",de,[t("button",{onClick:$,disabled:M.value,class:"btn btn-secondary flex items-center gap-2"},[m(u(F),{class:h(["h-4 w-4",{"animate-spin":M.value}])},null,8,["class"]),e[14]||(e[14]=b(" Refresh ",-1))],8,ue),t("button",{onClick:H,class:"btn btn-primary flex items-center gap-2"},[m(u(N),{class:"h-4 w-4"}),e[15]||(e[15]=b(" Add Upstream ",-1))])])]),k.value?(n(),r("div",ce,[t("p",pe,d(k.value),1)])):f("",!0),M.value&&v.value.length===0?(n(),r("div",me,[m(u(F),{class:"h-8 w-8 text-gray-400 animate-spin"})])):v.value.length===0?(n(),r("div",ve,[m(u(P),{class:"mx-auto h-12 w-12 text-gray-400"}),e[17]||(e[17]=t("h3",{class:"mt-2 text-sm font-semibold text-gray-900"},"No upstreams",-1)),e[18]||(e[18]=t("p",{class:"mt-1 text-sm text-gray-500"},"Get started by adding an upstream Harbor registry.",-1)),t("div",ye,[t("button",{onClick:H,class:"btn btn-primary"},[m(u(N),{class:"h-4 w-4 mr-2"}),e[16]||(e[16]=b(" Add Upstream ",-1))])])])):(n(),r("div",ge,[(n(!0),r(S,null,E(v.value,s=>{var i;return n(),r("div",{key:s.id,class:"card hover:shadow-lg transition-shadow"},[t("div",xe,[t("div",fe,[t("div",{class:h(["p-2 rounded-lg",s.enabled?"bg-primary-100":"bg-gray-100"])},[m(u(P),{class:h(["h-6 w-6",s.enabled?"text-primary-600":"text-gray-400"])},null,8,["class"])],2),t("div",null,[t("h3",be,d(s.display_name),1),t("p",he,d(s.name),1)])]),(n(),R(X((i=A.value.get(s.name))!=null&&i.healthy?u(se):u(ae)),{class:h(["h-5 w-5",O(s.name)])},null,8,["class"]))]),t("div",_e,[t("div",we,[m(u(le),{class:"h-4 w-4"}),t("span",ke,d(s.url),1)]),s.uses_multi_project?(n(),r("div",Ce,[e[19]||(e[19]=t("div",{class:"flex items-center gap-2"},[t("span",{class:"text-gray-500"},"Projects:"),t("span",{class:"text-xs text-blue-600 font-medium"},"Multi-project mode")],-1)),t("div",Me,[(n(!0),r(S,null,E(s.projects,o=>(n(),r("span",{key:o.name,class:h(["px-1.5 py-0.5 text-xs rounded bg-gray-100 text-gray-700 font-mono",{"bg-blue-100 text-blue-700":o.is_default}]),title:o.effective_pattern},d(o.name),11,Ue))),128))])])):(n(),r("div",Ve,[e[20]||(e[20]=t("span",{class:"text-gray-500"},"Registry:",-1)),t("span",je,d(s.registry),1)])),t("div",$e,[e[21]||(e[21]=t("span",{class:"text-gray-500"},"Priority:",-1)),t("span",Ae,d(s.priority),1)]),t("div",De,[s.is_default?(n(),r("span",Be," Default ")):f("",!0),t("span",{class:h([s.enabled?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500","px-2 py-0.5 text-xs rounded-full"])},d(s.enabled?"Enabled":"Disabled"),3),t("span",Te,d(s.cache_isolation),1),s.has_credentials?(n(),r("span",He," Auth ")):f("",!0)])]),t("div",Le,[t("button",{onClick:o=>q(s),class:"btn btn-secondary btn-sm flex items-center gap-1"},[m(u(Y),{class:"h-4 w-4"}),e[22]||(e[22]=b(" Edit ",-1))],8,Re),t("button",{onClick:o=>I(s),class:"btn btn-danger btn-sm flex items-center gap-1"},[m(u(ee),{class:"h-4 w-4"}),e[23]||(e[23]=b(" Delete ",-1))],8,Se)])])}),128))])),(n(),R(W,{to:"body"},[V.value?(n(),r("div",Ee,[t("div",Fe,[t("div",{class:"fixed inset-0 bg-black/50",onClick:B}),t("div",Ne,[t("h2",Pe,d(x.value==="create"?"Add Upstream":"Edit Upstream"),1),t("form",{onSubmit:K(z,["prevent"]),class:"space-y-4"},[x.value==="create"?(n(),r("div",qe,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700"},"Name",-1)),p(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.value.name=s),type:"text",required:"",class:"input mt-1",placeholder:"my-harbor"},null,512),[[_,l.value.name]]),e[25]||(e[25]=t("p",{class:"mt-1 text-xs text-gray-500"},"Unique identifier (alphanumeric, dashes, underscores)",-1))])):f("",!0),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700"},"Display Name",-1)),p(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.display_name=s),type:"text",required:"",class:"input mt-1",placeholder:"My Harbor Registry"},null,512),[[_,l.value.display_name]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700"},"URL",-1)),p(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.url=s),type:"url",required:"",class:"input mt-1",placeholder:"https://harbor.example.com"},null,512),[[_,l.value.url]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700"},"Registry/Project",-1)),p(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.registry=s),type:"text",required:"",class:"input mt-1",placeholder:"library"},null,512),[[_,l.value.registry]])]),t("div",Ze,[t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700"},"Username",-1)),p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.username=s),type:"text",class:"input mt-1",placeholder:x.value==="edit"?"(unchanged)":"Optional"},null,8,ze),[[_,l.value.username]])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-gray-700"},"Password",-1)),p(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.password=s),type:"password",class:"input mt-1",placeholder:x.value==="edit"?"(unchanged)":"Optional"},null,8,Ie),[[_,l.value.password]])])]),t("div",Oe,[t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-gray-700"},"Priority",-1)),p(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.priority=s),type:"number",class:"input mt-1",min:"0"},null,512),[[_,l.value.priority,void 0,{number:!0}]]),e[32]||(e[32]=t("p",{class:"mt-1 text-xs text-gray-500"},"Lower = higher priority",-1))]),t("div",null,[e[34]||(e[34]=t("label",{class:"block text-sm font-medium text-gray-700"},"Cache Isolation",-1)),p(t("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>l.value.cache_isolation=s),class:"input mt-1"},[...e[33]||(e[33]=[t("option",{value:"shared"},"Shared",-1),t("option",{value:"isolated"},"Isolated",-1)])],512),[[Q,l.value.cache_isolation]])])]),t("div",Ge,[t("label",Je,[p(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.value.enabled=s),type:"checkbox",class:"rounded"},null,512),[[T,l.value.enabled]]),e[35]||(e[35]=t("span",{class:"text-sm text-gray-700"},"Enabled",-1))]),t("label",Ke,[p(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>l.value.is_default=s),type:"checkbox",class:"rounded"},null,512),[[T,l.value.is_default]]),e[36]||(e[36]=t("span",{class:"text-sm text-gray-700"},"Default upstream",-1))]),t("label",Qe,[p(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>l.value.skip_tls_verify=s),type:"checkbox",class:"rounded"},null,512),[[T,l.value.skip_tls_verify]]),e[37]||(e[37]=t("span",{class:"text-sm text-gray-700"},"Skip TLS verify",-1))])]),t("div",We,[t("button",{type:"button",onClick:Z,disabled:j.value||!l.value.url||!l.value.registry,class:"btn btn-secondary flex items-center gap-2"},[m(u(te),{class:"h-4 w-4"}),b(" "+d(j.value?"Testing...":"Test Connection"),1)],8,Xe),y.value?(n(),r("div",{key:0,class:h(["mt-2 p-2 rounded text-sm",y.value.success?"bg-green-50 text-green-700":"bg-red-50 text-red-700"])},d(y.value.message),3)):f("",!0)]),t("div",Ye,[t("button",{type:"button",onClick:B,class:"btn btn-secondary"}," Cancel "),t("button",et,d(x.value==="create"?"Create":"Save"),1)])],32)])])])):f("",!0)]))]))}});export{nt as default};
