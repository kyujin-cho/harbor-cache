import{c as n,a as e,o,d as A,u as S,j as $,f as p,g as m,b as f,l as B,n as M,e as x,t as c,F as V,m as _}from"./index-oxDBCDlh.js";import{r as C}from"./ArrowPathIcon-ZfxELW0L.js";import{r as R}from"./TrashIcon-weaO9PdU.js";function T(w,y){return o(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function z(w,y){return o(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"})])}const E={class:"p-8"},N={class:"mb-8 flex items-center justify-between"},F=["disabled"],L={key:0,class:"mb-6 rounded-md bg-red-50 p-4"},Z={class:"text-sm text-red-700"},D={key:1,class:"mb-6 rounded-md bg-green-50 p-4"},H={class:"text-sm text-green-700"},q={key:2,class:"flex items-center justify-center h-64"},G={class:"card mb-6"},I={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},J={class:"text-xl font-bold text-gray-900"},K={class:"text-xl font-bold text-gray-900"},O={class:"text-xl font-bold text-gray-900"},P={class:"text-xl font-bold text-gray-900"},Q={key:0,class:"card"},U={class:"space-y-4"},W={class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg"},X={class:"flex items-center gap-3"},Y={class:"p-2 bg-blue-100 rounded-lg"},ee=["disabled"],te={class:"flex items-center justify-between p-4 bg-red-50 rounded-lg"},se={class:"flex items-center gap-3"},ae={class:"p-2 bg-red-100 rounded-lg"},le=["disabled"],ne={key:4,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},oe={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},re={class:"flex items-center gap-3 mb-4"},ie={class:"p-2 bg-red-100 rounded-full"},de={class:"flex justify-end gap-3"},me=A({__name:"CacheView",setup(w){const y=S(),u=m(null),g=m(!0),d=m(!1),r=m(""),v=m(""),b=m(!1);async function h(){var l,t,a,i;g.value=!0,r.value="";try{const s=await _.getStats();u.value=s.data}catch(s){r.value=((i=(a=(t=(l=s.response)==null?void 0:l.data)==null?void 0:t.errors)==null?void 0:a[0])==null?void 0:i.message)||"Failed to fetch stats"}finally{g.value=!1}}async function k(){var l,t,a,i;d.value=!0,r.value="",v.value="";try{const s=await _.cleanup();v.value=`Cleaned up ${s.data.cleaned} expired entries`,await h()}catch(s){r.value=((i=(a=(t=(l=s.response)==null?void 0:l.data)==null?void 0:t.errors)==null?void 0:a[0])==null?void 0:i.message)||"Cleanup failed"}finally{d.value=!1}}async function j(){var l,t,a,i;d.value=!0,r.value="",v.value="",b.value=!1;try{const s=await _.clear();v.value=`Cleared ${s.data.cleared} entries from cache`,await h()}catch(s){r.value=((i=(a=(t=(l=s.response)==null?void 0:l.data)==null?void 0:t.errors)==null?void 0:a[0])==null?void 0:i.message)||"Clear failed"}finally{d.value=!1}}return $(h),(l,t)=>(o(),n("div",E,[e("div",N,[t[3]||(t[3]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"Cache Management"),e("p",{class:"mt-1 text-sm text-gray-500"},"View and manage cached artifacts")],-1)),e("button",{onClick:h,disabled:g.value,class:"btn btn-secondary flex items-center gap-2"},[f(x(C),{class:M(["h-4 w-4",{"animate-spin":g.value}])},null,8,["class"]),t[2]||(t[2]=B(" Refresh ",-1))],8,F)]),r.value?(o(),n("div",L,[e("p",Z,c(r.value),1)])):p("",!0),v.value?(o(),n("div",D,[e("p",H,c(v.value),1)])):p("",!0),g.value?(o(),n("div",q,[f(x(C),{class:"h-8 w-8 text-gray-400 animate-spin"})])):u.value?(o(),n(V,{key:3},[e("div",G,[t[8]||(t[8]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Cache Statistics",-1)),e("div",I,[e("div",null,[t[4]||(t[4]=e("p",{class:"text-sm text-gray-500"},"Total Size",-1)),e("p",J,c(u.value.total_size_human),1)]),e("div",null,[t[5]||(t[5]=e("p",{class:"text-sm text-gray-500"},"Total Entries",-1)),e("p",K,c(u.value.entry_count),1)]),e("div",null,[t[6]||(t[6]=e("p",{class:"text-sm text-gray-500"},"Manifests",-1)),e("p",O,c(u.value.manifest_count),1)]),e("div",null,[t[7]||(t[7]=e("p",{class:"text-sm text-gray-500"},"Blobs",-1)),e("p",P,c(u.value.blob_count),1)])])]),x(y).isAdmin?(o(),n("div",Q,[t[11]||(t[11]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"Cache Actions",-1)),e("div",U,[e("div",W,[e("div",X,[e("div",Y,[f(x(T),{class:"h-6 w-6 text-blue-600"})]),t[9]||(t[9]=e("div",null,[e("p",{class:"font-medium text-gray-900"},"Cleanup Expired Entries"),e("p",{class:"text-sm text-gray-500"},"Remove entries older than the retention period")],-1))]),e("button",{onClick:k,disabled:d.value,class:"btn btn-secondary"},c(d.value?"Running...":"Run Cleanup"),9,ee)]),e("div",te,[e("div",se,[e("div",ae,[f(x(R),{class:"h-6 w-6 text-red-600"})]),t[10]||(t[10]=e("div",null,[e("p",{class:"font-medium text-gray-900"},"Clear All Cache"),e("p",{class:"text-sm text-gray-500"},"Remove all cached entries (this cannot be undone)")],-1))]),e("button",{onClick:t[0]||(t[0]=a=>b.value=!0),disabled:d.value,class:"btn btn-danger"}," Clear Cache ",8,le)])])])):p("",!0)],64)):p("",!0),b.value?(o(),n("div",ne,[e("div",oe,[e("div",re,[e("div",ie,[f(x(z),{class:"h-6 w-6 text-red-600"})]),t[12]||(t[12]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Clear All Cache?",-1))]),t[13]||(t[13]=e("p",{class:"text-gray-600 mb-6"}," This will remove all cached manifests and blobs. This action cannot be undone. ",-1)),e("div",de,[e("button",{onClick:t[1]||(t[1]=a=>b.value=!1),class:"btn btn-secondary"}," Cancel "),e("button",{onClick:j,class:"btn btn-danger"}," Clear All ")])])])):p("",!0)]))}});export{me as default};
