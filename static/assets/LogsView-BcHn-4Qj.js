import{d as I,j as q,c as n,a as e,f as p,g as u,b as v,m as L,n as M,e as x,t as o,h as w,A as R,F as A,s as S,v as j,p as H,y as T,o as i}from"./index-IIFH34Dd.js";import{r as P}from"./ArrowPathIcon-oPnaH1Jj.js";import{r as J,a as G,b as K}from"./FunnelIcon-B_rgCtX7.js";import{r as Q}from"./ClockIcon-CJmKLPaO.js";const W={class:"p-8"},X={class:"mb-8 flex items-center justify-between"},Y=["disabled"],Z={key:0,class:"mb-6 rounded-md bg-red-50 p-4"},ee={class:"text-sm text-red-700"},te={class:"card mb-6"},se={class:"flex items-center justify-between mb-4"},ae={key:0,class:"space-y-4"},le={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ne=["value"],oe=["value"],ie={key:1,class:"flex items-center justify-center h-64"},re={key:2,class:"card p-0 overflow-hidden"},de={class:"overflow-x-auto"},ue={class:"min-w-full divide-y divide-gray-200"},ce={class:"bg-white divide-y divide-gray-200"},pe={class:"px-6 py-4 whitespace-nowrap"},ve={class:"flex items-center gap-2"},xe={class:"text-sm text-gray-900"},ye={class:"text-xs text-gray-500"},me={class:"px-6 py-4 whitespace-nowrap"},fe={class:"px-6 py-4 whitespace-nowrap"},ge={class:"text-sm font-medium text-gray-900"},_e={key:0,class:"text-xs text-gray-500 font-mono"},be={class:"px-6 py-4 whitespace-nowrap"},he={class:"text-sm text-gray-900"},we={key:0,class:"text-xs text-gray-500"},ke={class:"px-6 py-4"},Ae=["title"],Se={key:1,class:"text-sm text-gray-400"},Te={key:0},Ce={key:0,class:"flex items-center justify-between px-6 py-4 border-t"},De={class:"text-sm text-gray-500"},Fe={class:"flex items-center gap-2"},Ve=["disabled"],$e={class:"text-sm text-gray-700"},Le=["disabled"],Ue=I({__name:"LogsView",setup(Me){const k=u([]),C=u([]),D=u([]),y=u(!0),f=u(""),r=u(1),m=u(20),g=u(0),a=u({action:"",resource_type:"",start_date:"",end_date:""}),_=u(!1),b=H(()=>Math.ceil(g.value/m.value));async function h(){var l,t,s,d;y.value=!0,f.value="";try{const c={offset:(r.value-1)*m.value,limit:m.value};a.value.action&&(c.action=a.value.action),a.value.resource_type&&(c.resource_type=a.value.resource_type),a.value.start_date&&(c.start_date=new Date(a.value.start_date).toISOString()),a.value.end_date&&(c.end_date=new Date(a.value.end_date).toISOString());const $=await T.list(c);k.value=$.data.logs,g.value=$.data.total}catch(c){f.value=((d=(s=(t=(l=c.response)==null?void 0:l.data)==null?void 0:t.errors)==null?void 0:s[0])==null?void 0:d.message)||"Failed to fetch logs"}finally{y.value=!1}}async function N(){try{const[l,t]=await Promise.all([T.getActions(),T.getResourceTypes()]);C.value=l.data,D.value=t.data}catch(l){console.error("Failed to fetch filter options:",l)}}async function F(){await Promise.all([h(),N()])}function U(){r.value=1,h()}function B(){a.value={action:"",resource_type:"",start_date:"",end_date:""},r.value=1,h()}function V(l){l>=1&&l<=b.value&&(r.value=l,h())}function O(l){return new Date(l).toLocaleString()}function z(l){const t=new Date(l),d=new Date().getTime()-t.getTime();return d<6e4?"Just now":d<36e5?`${Math.floor(d/6e4)} min ago`:d<864e5?`${Math.floor(d/36e5)} hours ago`:d<6048e5?`${Math.floor(d/864e5)} days ago`:t.toLocaleDateString()}function E(l){const t=l.toLowerCase();return t.includes("delete")||t.includes("clear")?"bg-red-100 text-red-800":t.includes("create")||t.includes("add")?"bg-green-100 text-green-800":t.includes("update")||t.includes("edit")?"bg-blue-100 text-blue-800":t.includes("login")||t.includes("auth")?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}return q(F),(l,t)=>(i(),n("div",W,[e("div",X,[t[8]||(t[8]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"Activity Logs"),e("p",{class:"mt-1 text-sm text-gray-500"},"View system activity and audit logs")],-1)),e("button",{onClick:F,disabled:y.value,class:"btn btn-secondary flex items-center gap-2"},[v(x(P),{class:M(["h-4 w-4",{"animate-spin":y.value}])},null,8,["class"]),t[7]||(t[7]=L(" Refresh ",-1))],8,Y)]),f.value?(i(),n("div",Z,[e("p",ee,o(f.value),1)])):p("",!0),e("div",te,[e("div",se,[t[9]||(t[9]=e("h2",{class:"text-lg font-semibold text-gray-900"},"Filters",-1)),e("button",{onClick:t[0]||(t[0]=s=>_.value=!_.value),class:"btn btn-secondary flex items-center gap-2 text-sm"},[v(x(J),{class:"h-4 w-4"}),L(" "+o(_.value?"Hide":"Show")+" Filters ",1)])]),_.value?(i(),n("div",ae,[e("div",le,[e("div",null,[t[11]||(t[11]=e("label",{class:"label"},"Action",-1)),w(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.action=s),class:"input text-sm"},[t[10]||(t[10]=e("option",{value:""},"All Actions",-1)),(i(!0),n(A,null,S(C.value,s=>(i(),n("option",{key:s,value:s},o(s),9,ne))),128))],512),[[R,a.value.action]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"label"},"Resource Type",-1)),w(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>a.value.resource_type=s),class:"input text-sm"},[t[12]||(t[12]=e("option",{value:""},"All Types",-1)),(i(!0),n(A,null,S(D.value,s=>(i(),n("option",{key:s,value:s},o(s),9,oe))),128))],512),[[R,a.value.resource_type]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"label"},"Start Date",-1)),w(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>a.value.start_date=s),type:"date",class:"input text-sm"},null,512),[[j,a.value.start_date]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"label"},"End Date",-1)),w(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>a.value.end_date=s),type:"date",class:"input text-sm"},null,512),[[j,a.value.end_date]])])]),e("div",{class:"flex justify-end gap-2"},[e("button",{onClick:B,class:"btn btn-secondary text-sm"},"Clear"),e("button",{onClick:U,class:"btn btn-primary text-sm"},"Apply Filters")])])):p("",!0)]),y.value?(i(),n("div",ie,[v(x(P),{class:"h-8 w-8 text-gray-400 animate-spin"})])):(i(),n("div",re,[e("div",de,[e("table",ue,[t[17]||(t[17]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Timestamp "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Action "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Resource "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," User "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Details ")])],-1)),e("tbody",ce,[(i(!0),n(A,null,S(k.value,s=>(i(),n("tr",{key:s.id,class:"hover:bg-gray-50"},[e("td",pe,[e("div",ve,[v(x(Q),{class:"h-4 w-4 text-gray-400"}),e("div",null,[e("p",xe,o(z(s.timestamp)),1),e("p",ye,o(O(s.timestamp)),1)])])]),e("td",me,[e("span",{class:M(["px-2 py-1 text-xs font-medium rounded-full",E(s.action)])},o(s.action),3)]),e("td",fe,[e("div",null,[e("p",ge,o(s.resource_type),1),s.resource_id?(i(),n("p",_e,o(s.resource_id.length>30?s.resource_id.substring(0,30)+"...":s.resource_id),1)):p("",!0)])]),e("td",be,[e("p",he,o(s.username||"System"),1),s.ip_address?(i(),n("p",we,o(s.ip_address),1)):p("",!0)]),e("td",ke,[s.details?(i(),n("p",{key:0,class:"text-sm text-gray-700 max-w-xs truncate",title:s.details},o(s.details),9,Ae)):(i(),n("p",Se,"-"))])]))),128)),k.value.length===0?(i(),n("tr",Te,[...t[16]||(t[16]=[e("td",{colspan:"5",class:"px-6 py-12 text-center text-gray-500"}," No activity logs found ",-1)])])):p("",!0)])])]),b.value>1?(i(),n("div",Ce,[e("div",De," Showing "+o((r.value-1)*m.value+1)+" to "+o(Math.min(r.value*m.value,g.value))+" of "+o(g.value)+" logs ",1),e("div",Fe,[e("button",{onClick:t[5]||(t[5]=s=>V(r.value-1)),disabled:r.value===1,class:"btn btn-secondary p-2"},[v(x(G),{class:"h-4 w-4"})],8,Ve),e("span",$e,"Page "+o(r.value)+" of "+o(b.value),1),e("button",{onClick:t[6]||(t[6]=s=>V(r.value+1)),disabled:r.value===b.value,class:"btn btn-secondary p-2"},[v(x(K),{class:"h-4 w-4"})],8,Le)])])):p("",!0)]))]))}});export{Ue as default};
