import{c as o,a as e,o as n,d as z,j as I,f as b,l as S,g as c,b as v,m as h,n as _,e as d,t as u,F as O,s as G,w as J,h as p,v as x,A as K,C as B,T as Q,D as w,E as W}from"./index-IIFH34Dd.js";import{r as T}from"./ArrowPathIcon-oPnaH1Jj.js";import{r as E,a as X}from"./PlusIcon-uzYT2dRF.js";import{r as Y}from"./TrashIcon-C3NpBTHa.js";function ee(k,m){return n(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.75 3.104v5.714a2.25 2.25 0 0 1-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 0 1 4.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0 1 12 15a9.065 9.065 0 0 0-6.23-.693L5 14.5m14.8.8 1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0 1 12 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5"})])}function te(k,m){return n(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function se(k,m){return n(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"})])}function N(k,m){return n(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.75 17.25v-.228a4.5 4.5 0 0 0-.12-1.03l-2.268-9.64a3.375 3.375 0 0 0-3.285-2.602H7.923a3.375 3.375 0 0 0-3.285 2.602l-2.268 9.64a4.5 4.5 0 0 0-.12 1.03v.228m19.5 0a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3m19.5 0a3 3 0 0 0-3-3H5.25a3 3 0 0 0-3 3m16.5 0h.008v.008h-.008v-.008Zm-3 0h.008v.008h-.008v-.008Z"})])}function le(k,m){return n(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}const ae={class:"p-8"},ne={class:"mb-8 flex items-center justify-between"},re={class:"flex items-center gap-3"},oe=["disabled"],ie={key:0,class:"mb-6 rounded-md bg-red-50 p-4"},de={class:"text-sm text-red-700"},ue={key:1,class:"flex items-center justify-center h-64"},pe={key:2,class:"text-center py-12"},ce={class:"mt-6"},ve={key:3,class:"grid gap-6 md:grid-cols-2 lg:grid-cols-3"},me={class:"flex items-start justify-between mb-4"},ye={class:"flex items-center gap-3"},ge={class:"font-semibold text-gray-900"},xe={class:"text-xs text-gray-500 font-mono"},fe={class:"space-y-2 text-sm"},be={class:"flex items-center gap-2 text-gray-600"},he={class:"truncate"},_e={class:"flex items-center gap-2"},we={class:"font-mono text-gray-700"},ke={class:"flex items-center gap-2"},Ce={class:"text-gray-700"},Ue={class:"flex flex-wrap gap-2 mt-3"},Me={key:0,class:"px-2 py-0.5 text-xs rounded-full bg-yellow-100 text-yellow-700"},Ve={class:"px-2 py-0.5 text-xs rounded-full bg-blue-100 text-blue-700"},je={key:1,class:"px-2 py-0.5 text-xs rounded-full bg-purple-100 text-purple-700"},$e={class:"mt-4 pt-4 border-t flex justify-end gap-2"},Ae=["onClick"],De=["onClick"],Be={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},He={class:"flex min-h-screen items-center justify-center p-4"},Le={class:"relative bg-white rounded-lg shadow-xl max-w-lg w-full p-6"},Se={class:"text-lg font-semibold mb-4"},Te={key:0},Ee={class:"grid grid-cols-2 gap-4"},Ne=["placeholder"],Re=["placeholder"],Fe={class:"grid grid-cols-2 gap-4"},qe={class:"flex flex-wrap gap-4"},Pe={class:"flex items-center gap-2"},Ze={class:"flex items-center gap-2"},ze={class:"flex items-center gap-2"},Ie={class:"pt-4 border-t"},Oe=["disabled"],Ge={class:"flex justify-end gap-3 pt-4"},Je={type:"submit",class:"btn btn-primary"},Ye=z({__name:"UpstreamsView",setup(k){const m=c([]),A=c(new Map),C=c(!0),f=c(""),V=c(!1),g=c("create"),U=c(null),l=c({name:"",display_name:"",url:"",registry:"",username:"",password:"",skip_tls_verify:!1,priority:100,enabled:!0,cache_isolation:"shared",is_default:!1,routes:[]}),j=c(!1),y=c(null);async function $(){var a,t,s,i;try{C.value=!0,f.value="";const r=await w.list();m.value=r.data;try{const M=await w.getAllHealth();A.value=new Map(M.data.map(L=>[L.upstream_id,L]))}catch(M){console.error("Failed to fetch health status:",M)}}catch(r){f.value=((i=(s=(t=(a=r.response)==null?void 0:a.data)==null?void 0:t.errors)==null?void 0:s[0])==null?void 0:i.message)||"Failed to fetch upstreams"}finally{C.value=!1}}function H(){g.value="create",U.value=null,l.value={name:"",display_name:"",url:"",registry:"",username:"",password:"",skip_tls_verify:!1,priority:100,enabled:!0,cache_isolation:"shared",is_default:!1,routes:[]},y.value=null,V.value=!0}function R(a){g.value="edit",U.value=a,l.value={name:a.name,display_name:a.display_name,url:a.url,registry:a.registry,username:"",password:"",skip_tls_verify:a.skip_tls_verify,priority:a.priority,enabled:a.enabled,cache_isolation:a.cache_isolation,is_default:a.is_default,routes:[]},y.value=null,V.value=!0}function D(){V.value=!1,U.value=null,y.value=null}async function F(){var a,t,s,i;j.value=!0,y.value=null;try{const r=await w.test({url:l.value.url,registry:l.value.registry,username:l.value.username||void 0,password:l.value.password||void 0,skip_tls_verify:l.value.skip_tls_verify});y.value=r.data}catch(r){y.value={success:!1,message:((i=(s=(t=(a=r.response)==null?void 0:a.data)==null?void 0:t.errors)==null?void 0:s[0])==null?void 0:i.message)||"Test failed"}}finally{j.value=!1}}async function q(){var a,t,s,i;try{if(g.value==="create")await w.create(l.value);else if(U.value){const r={display_name:l.value.display_name,url:l.value.url,registry:l.value.registry,skip_tls_verify:l.value.skip_tls_verify,priority:l.value.priority,enabled:l.value.enabled,cache_isolation:l.value.cache_isolation,is_default:l.value.is_default};l.value.username&&(r.username=l.value.username),l.value.password&&(r.password=l.value.password),await w.update(U.value.id,r)}D(),$()}catch(r){f.value=((i=(s=(t=(a=r.response)==null?void 0:a.data)==null?void 0:t.errors)==null?void 0:s[0])==null?void 0:i.message)||"Failed to save upstream"}}async function P(a){var t,s,i,r;if(confirm(`Are you sure you want to delete upstream "${a.display_name}"?`))try{await w.delete(a.id),$()}catch(M){f.value=((r=(i=(s=(t=M.response)==null?void 0:t.data)==null?void 0:s.errors)==null?void 0:i[0])==null?void 0:r.message)||"Failed to delete upstream"}}function Z(a){const t=A.value.get(a);return t?t.healthy?"text-green-500":"text-red-500":"text-gray-400"}return I($),(a,t)=>(n(),o("div",ae,[e("div",ne,[t[13]||(t[13]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"Upstreams"),e("p",{class:"mt-1 text-sm text-gray-500"},"Manage upstream Harbor registries")],-1)),e("div",re,[e("button",{onClick:$,disabled:C.value,class:"btn btn-secondary flex items-center gap-2"},[v(d(T),{class:_(["h-4 w-4",{"animate-spin":C.value}])},null,8,["class"]),t[11]||(t[11]=h(" Refresh ",-1))],8,oe),e("button",{onClick:H,class:"btn btn-primary flex items-center gap-2"},[v(d(E),{class:"h-4 w-4"}),t[12]||(t[12]=h(" Add Upstream ",-1))])])]),f.value?(n(),o("div",ie,[e("p",de,u(f.value),1)])):b("",!0),C.value&&m.value.length===0?(n(),o("div",ue,[v(d(T),{class:"h-8 w-8 text-gray-400 animate-spin"})])):m.value.length===0?(n(),o("div",pe,[v(d(N),{class:"mx-auto h-12 w-12 text-gray-400"}),t[15]||(t[15]=e("h3",{class:"mt-2 text-sm font-semibold text-gray-900"},"No upstreams",-1)),t[16]||(t[16]=e("p",{class:"mt-1 text-sm text-gray-500"},"Get started by adding an upstream Harbor registry.",-1)),e("div",ce,[e("button",{onClick:H,class:"btn btn-primary"},[v(d(E),{class:"h-4 w-4 mr-2"}),t[14]||(t[14]=h(" Add Upstream ",-1))])])])):(n(),o("div",ve,[(n(!0),o(O,null,G(m.value,s=>{var i;return n(),o("div",{key:s.id,class:"card hover:shadow-lg transition-shadow"},[e("div",me,[e("div",ye,[e("div",{class:_(["p-2 rounded-lg",s.enabled?"bg-primary-100":"bg-gray-100"])},[v(d(N),{class:_(["h-6 w-6",s.enabled?"text-primary-600":"text-gray-400"])},null,8,["class"])],2),e("div",null,[e("h3",ge,u(s.display_name),1),e("p",xe,u(s.name),1)])]),(n(),S(W((i=A.value.get(s.id))!=null&&i.healthy?d(te):d(le)),{class:_(["h-5 w-5",Z(s.id)])},null,8,["class"]))]),e("div",fe,[e("div",be,[v(d(se),{class:"h-4 w-4"}),e("span",he,u(s.url),1)]),e("div",_e,[t[17]||(t[17]=e("span",{class:"text-gray-500"},"Registry:",-1)),e("span",we,u(s.registry),1)]),e("div",ke,[t[18]||(t[18]=e("span",{class:"text-gray-500"},"Priority:",-1)),e("span",Ce,u(s.priority),1)]),e("div",Ue,[s.is_default?(n(),o("span",Me," Default ")):b("",!0),e("span",{class:_([s.enabled?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500","px-2 py-0.5 text-xs rounded-full"])},u(s.enabled?"Enabled":"Disabled"),3),e("span",Ve,u(s.cache_isolation),1),s.has_credentials?(n(),o("span",je," Auth ")):b("",!0)])]),e("div",$e,[e("button",{onClick:r=>R(s),class:"btn btn-secondary btn-sm flex items-center gap-1"},[v(d(X),{class:"h-4 w-4"}),t[19]||(t[19]=h(" Edit ",-1))],8,Ae),e("button",{onClick:r=>P(s),class:"btn btn-danger btn-sm flex items-center gap-1"},[v(d(Y),{class:"h-4 w-4"}),t[20]||(t[20]=h(" Delete ",-1))],8,De)])])}),128))])),(n(),S(Q,{to:"body"},[V.value?(n(),o("div",Be,[e("div",He,[e("div",{class:"fixed inset-0 bg-black/50",onClick:D}),e("div",Le,[e("h2",Se,u(g.value==="create"?"Add Upstream":"Edit Upstream"),1),e("form",{onSubmit:J(q,["prevent"]),class:"space-y-4"},[g.value==="create"?(n(),o("div",Te,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700"},"Name",-1)),p(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.value.name=s),type:"text",required:"",class:"input mt-1",placeholder:"my-harbor"},null,512),[[x,l.value.name]]),t[22]||(t[22]=e("p",{class:"mt-1 text-xs text-gray-500"},"Unique identifier (alphanumeric, dashes, underscores)",-1))])):b("",!0),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700"},"Display Name",-1)),p(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.value.display_name=s),type:"text",required:"",class:"input mt-1",placeholder:"My Harbor Registry"},null,512),[[x,l.value.display_name]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700"},"URL",-1)),p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.value.url=s),type:"url",required:"",class:"input mt-1",placeholder:"https://harbor.example.com"},null,512),[[x,l.value.url]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700"},"Registry/Project",-1)),p(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.value.registry=s),type:"text",required:"",class:"input mt-1",placeholder:"library"},null,512),[[x,l.value.registry]])]),e("div",Ee,[e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700"},"Username",-1)),p(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>l.value.username=s),type:"text",class:"input mt-1",placeholder:g.value==="edit"?"(unchanged)":"Optional"},null,8,Ne),[[x,l.value.username]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"block text-sm font-medium text-gray-700"},"Password",-1)),p(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>l.value.password=s),type:"password",class:"input mt-1",placeholder:g.value==="edit"?"(unchanged)":"Optional"},null,8,Re),[[x,l.value.password]])])]),e("div",Fe,[e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700"},"Priority",-1)),p(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>l.value.priority=s),type:"number",class:"input mt-1",min:"0"},null,512),[[x,l.value.priority,void 0,{number:!0}]]),t[29]||(t[29]=e("p",{class:"mt-1 text-xs text-gray-500"},"Lower = higher priority",-1))]),e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium text-gray-700"},"Cache Isolation",-1)),p(e("select",{"onUpdate:modelValue":t[7]||(t[7]=s=>l.value.cache_isolation=s),class:"input mt-1"},[...t[30]||(t[30]=[e("option",{value:"shared"},"Shared",-1),e("option",{value:"isolated"},"Isolated",-1)])],512),[[K,l.value.cache_isolation]])])]),e("div",qe,[e("label",Pe,[p(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>l.value.enabled=s),type:"checkbox",class:"rounded"},null,512),[[B,l.value.enabled]]),t[32]||(t[32]=e("span",{class:"text-sm text-gray-700"},"Enabled",-1))]),e("label",Ze,[p(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>l.value.is_default=s),type:"checkbox",class:"rounded"},null,512),[[B,l.value.is_default]]),t[33]||(t[33]=e("span",{class:"text-sm text-gray-700"},"Default upstream",-1))]),e("label",ze,[p(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>l.value.skip_tls_verify=s),type:"checkbox",class:"rounded"},null,512),[[B,l.value.skip_tls_verify]]),t[34]||(t[34]=e("span",{class:"text-sm text-gray-700"},"Skip TLS verify",-1))])]),e("div",Ie,[e("button",{type:"button",onClick:F,disabled:j.value||!l.value.url||!l.value.registry,class:"btn btn-secondary flex items-center gap-2"},[v(d(ee),{class:"h-4 w-4"}),h(" "+u(j.value?"Testing...":"Test Connection"),1)],8,Oe),y.value?(n(),o("div",{key:0,class:_(["mt-2 p-2 rounded text-sm",y.value.success?"bg-green-50 text-green-700":"bg-red-50 text-red-700"])},u(y.value.message),3)):b("",!0)]),e("div",Ge,[e("button",{type:"button",onClick:D,class:"btn btn-secondary"}," Cancel "),e("button",Je,u(g.value==="create"?"Create":"Save"),1)])],32)])])])):b("",!0)]))]))}});export{Ye as default};
