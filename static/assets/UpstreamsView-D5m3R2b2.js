import{c as r,a as t,o as n,d as I,j as O,f,l as R,g as p,m as b,t as d,b as m,n as k,e as u,F as G,s as J,w as K,h as c,v as h,A as Q,C as T,T as W,D as _,E as X}from"./index-CQZJkS29.js";import{r as S}from"./ArrowPathIcon-DlvPnKNn.js";import{r as E,a as Y}from"./PlusIcon-C0hu2H4I.js";import{r as ee}from"./TrashIcon-BHqW53U8.js";function te(C,v){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.75 3.104v5.714a2.25 2.25 0 0 1-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 0 1 4.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0 1 12 15a9.065 9.065 0 0 0-6.23-.693L5 14.5m14.8.8 1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0 1 12 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5"})])}function se(C,v){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function le(C,v){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"})])}function F(C,v){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.75 17.25v-.228a4.5 4.5 0 0 0-.12-1.03l-2.268-9.64a3.375 3.375 0 0 0-3.285-2.602H7.923a3.375 3.375 0 0 0-3.285 2.602l-2.268 9.64a4.5 4.5 0 0 0-.12 1.03v.228m19.5 0a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3m19.5 0a3 3 0 0 0-3-3H5.25a3 3 0 0 0-3 3m16.5 0h.008v.008h-.008v-.008Zm-3 0h.008v.008h-.008v-.008Z"})])}function ae(C,v){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}const ne={class:"p-8"},oe={class:"mb-8 flex items-center justify-between"},re={key:0,class:"mt-1 text-xs text-blue-600"},ie={class:"font-mono bg-blue-50 px-1 rounded"},de={class:"flex items-center gap-3"},ue=["disabled"],pe={key:0,class:"mb-6 rounded-md bg-red-50 p-4"},ce={class:"text-sm text-red-700"},me={key:1,class:"flex items-center justify-center h-64"},ve={key:2,class:"text-center py-12"},ye={class:"mt-6"},ge={key:3,class:"grid gap-6 md:grid-cols-2 lg:grid-cols-3"},xe={class:"flex items-start justify-between mb-4"},fe={class:"flex items-center gap-3"},be={class:"font-semibold text-gray-900"},he={class:"text-xs text-gray-500 font-mono"},_e={class:"space-y-2 text-sm"},we={class:"flex items-center gap-2 text-gray-600"},ke={class:"truncate"},Ce={class:"flex items-center gap-2"},Ue={class:"font-mono text-gray-700"},Me={class:"flex items-center gap-2"},Ve={class:"text-gray-700"},je={class:"flex flex-wrap gap-2 mt-3"},$e={key:0,class:"px-2 py-0.5 text-xs rounded-full bg-yellow-100 text-yellow-700"},Ae={class:"px-2 py-0.5 text-xs rounded-full bg-blue-100 text-blue-700"},De={key:1,class:"px-2 py-0.5 text-xs rounded-full bg-purple-100 text-purple-700"},Be={class:"mt-4 pt-4 border-t flex justify-end gap-2"},Te=["onClick"],He=["onClick"],Le={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},Re={class:"flex min-h-screen items-center justify-center p-4"},Se={class:"relative bg-white rounded-lg shadow-xl max-w-lg w-full p-6"},Ee={class:"text-lg font-semibold mb-4"},Fe={key:0},Ne={class:"grid grid-cols-2 gap-4"},Pe=["placeholder"],qe=["placeholder"],Ze={class:"grid grid-cols-2 gap-4"},ze={class:"flex flex-wrap gap-4"},Ie={class:"flex items-center gap-2"},Oe={class:"flex items-center gap-2"},Ge={class:"flex items-center gap-2"},Je={class:"pt-4 border-t"},Ke=["disabled"],Qe={class:"flex justify-end gap-3 pt-4"},We={type:"submit",class:"btn btn-primary"},st=I({__name:"UpstreamsView",setup(C){const v=p([]),A=p(new Map),U=p(!0),w=p(""),D=p(null),V=p(!1),x=p("create"),M=p(null),l=p({name:"",display_name:"",url:"",registry:"",username:"",password:"",skip_tls_verify:!1,priority:100,enabled:!0,cache_isolation:"shared",is_default:!1,routes:[]}),j=p(!1),y=p(null);async function $(){var a,e,s,i;try{U.value=!0,w.value="";const o=await _.list();v.value=o.data;try{const g=await _.getAllHealth();A.value=new Map(g.data.map(L=>[L.name,L]))}catch(g){console.error("Failed to fetch health status:",g)}try{const g=await _.getConfigPath();D.value=g.data.path}catch(g){console.error("Failed to fetch config path:",g)}}catch(o){w.value=((i=(s=(e=(a=o.response)==null?void 0:a.data)==null?void 0:e.errors)==null?void 0:s[0])==null?void 0:i.message)||"Failed to fetch upstreams"}finally{U.value=!1}}function H(){x.value="create",M.value=null,l.value={name:"",display_name:"",url:"",registry:"",username:"",password:"",skip_tls_verify:!1,priority:100,enabled:!0,cache_isolation:"shared",is_default:!1,routes:[]},y.value=null,V.value=!0}function N(a){x.value="edit",M.value=a,l.value={name:a.name,display_name:a.display_name,url:a.url,registry:a.registry,username:"",password:"",skip_tls_verify:a.skip_tls_verify,priority:a.priority,enabled:a.enabled,cache_isolation:a.cache_isolation,is_default:a.is_default,routes:[]},y.value=null,V.value=!0}function B(){V.value=!1,M.value=null,y.value=null}async function P(){var a,e,s,i;j.value=!0,y.value=null;try{const o=await _.test({url:l.value.url,registry:l.value.registry,username:l.value.username||void 0,password:l.value.password||void 0,skip_tls_verify:l.value.skip_tls_verify});y.value=o.data}catch(o){y.value={success:!1,message:((i=(s=(e=(a=o.response)==null?void 0:a.data)==null?void 0:e.errors)==null?void 0:s[0])==null?void 0:i.message)||"Test failed"}}finally{j.value=!1}}async function q(){var a,e,s,i;try{if(x.value==="create")await _.create(l.value);else if(M.value){const o={display_name:l.value.display_name,url:l.value.url,registry:l.value.registry,skip_tls_verify:l.value.skip_tls_verify,priority:l.value.priority,enabled:l.value.enabled,cache_isolation:l.value.cache_isolation,is_default:l.value.is_default};l.value.username&&(o.username=l.value.username),l.value.password&&(o.password=l.value.password),await _.update(M.value.name,o)}B(),$()}catch(o){w.value=((i=(s=(e=(a=o.response)==null?void 0:a.data)==null?void 0:e.errors)==null?void 0:s[0])==null?void 0:i.message)||"Failed to save upstream"}}async function Z(a){var e,s,i,o;if(confirm(`Are you sure you want to delete upstream "${a.display_name}"? This will update the config file.`))try{await _.delete(a.name),$()}catch(g){w.value=((o=(i=(s=(e=g.response)==null?void 0:e.data)==null?void 0:s.errors)==null?void 0:i[0])==null?void 0:o.message)||"Failed to delete upstream"}}function z(a){const e=A.value.get(a);return e?e.healthy?"text-green-500":"text-red-500":"text-gray-400"}return O($),(a,e)=>(n(),r("div",ne,[t("div",oe,[t("div",null,[e[12]||(e[12]=t("h1",{class:"text-2xl font-bold text-gray-900"},"Upstreams",-1)),e[13]||(e[13]=t("p",{class:"mt-1 text-sm text-gray-500"},"Manage upstream Harbor registries",-1)),D.value?(n(),r("p",re,[e[11]||(e[11]=b(" Changes are persisted to: ",-1)),t("code",ie,d(D.value),1)])):f("",!0)]),t("div",de,[t("button",{onClick:$,disabled:U.value,class:"btn btn-secondary flex items-center gap-2"},[m(u(S),{class:k(["h-4 w-4",{"animate-spin":U.value}])},null,8,["class"]),e[14]||(e[14]=b(" Refresh ",-1))],8,ue),t("button",{onClick:H,class:"btn btn-primary flex items-center gap-2"},[m(u(E),{class:"h-4 w-4"}),e[15]||(e[15]=b(" Add Upstream ",-1))])])]),w.value?(n(),r("div",pe,[t("p",ce,d(w.value),1)])):f("",!0),U.value&&v.value.length===0?(n(),r("div",me,[m(u(S),{class:"h-8 w-8 text-gray-400 animate-spin"})])):v.value.length===0?(n(),r("div",ve,[m(u(F),{class:"mx-auto h-12 w-12 text-gray-400"}),e[17]||(e[17]=t("h3",{class:"mt-2 text-sm font-semibold text-gray-900"},"No upstreams",-1)),e[18]||(e[18]=t("p",{class:"mt-1 text-sm text-gray-500"},"Get started by adding an upstream Harbor registry.",-1)),t("div",ye,[t("button",{onClick:H,class:"btn btn-primary"},[m(u(E),{class:"h-4 w-4 mr-2"}),e[16]||(e[16]=b(" Add Upstream ",-1))])])])):(n(),r("div",ge,[(n(!0),r(G,null,J(v.value,s=>{var i;return n(),r("div",{key:s.id,class:"card hover:shadow-lg transition-shadow"},[t("div",xe,[t("div",fe,[t("div",{class:k(["p-2 rounded-lg",s.enabled?"bg-primary-100":"bg-gray-100"])},[m(u(F),{class:k(["h-6 w-6",s.enabled?"text-primary-600":"text-gray-400"])},null,8,["class"])],2),t("div",null,[t("h3",be,d(s.display_name),1),t("p",he,d(s.name),1)])]),(n(),R(X((i=A.value.get(s.name))!=null&&i.healthy?u(se):u(ae)),{class:k(["h-5 w-5",z(s.name)])},null,8,["class"]))]),t("div",_e,[t("div",we,[m(u(le),{class:"h-4 w-4"}),t("span",ke,d(s.url),1)]),t("div",Ce,[e[19]||(e[19]=t("span",{class:"text-gray-500"},"Registry:",-1)),t("span",Ue,d(s.registry),1)]),t("div",Me,[e[20]||(e[20]=t("span",{class:"text-gray-500"},"Priority:",-1)),t("span",Ve,d(s.priority),1)]),t("div",je,[s.is_default?(n(),r("span",$e," Default ")):f("",!0),t("span",{class:k([s.enabled?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500","px-2 py-0.5 text-xs rounded-full"])},d(s.enabled?"Enabled":"Disabled"),3),t("span",Ae,d(s.cache_isolation),1),s.has_credentials?(n(),r("span",De," Auth ")):f("",!0)])]),t("div",Be,[t("button",{onClick:o=>N(s),class:"btn btn-secondary btn-sm flex items-center gap-1"},[m(u(Y),{class:"h-4 w-4"}),e[21]||(e[21]=b(" Edit ",-1))],8,Te),t("button",{onClick:o=>Z(s),class:"btn btn-danger btn-sm flex items-center gap-1"},[m(u(ee),{class:"h-4 w-4"}),e[22]||(e[22]=b(" Delete ",-1))],8,He)])])}),128))])),(n(),R(W,{to:"body"},[V.value?(n(),r("div",Le,[t("div",Re,[t("div",{class:"fixed inset-0 bg-black/50",onClick:B}),t("div",Se,[t("h2",Ee,d(x.value==="create"?"Add Upstream":"Edit Upstream"),1),t("form",{onSubmit:K(q,["prevent"]),class:"space-y-4"},[x.value==="create"?(n(),r("div",Fe,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700"},"Name",-1)),c(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.value.name=s),type:"text",required:"",class:"input mt-1",placeholder:"my-harbor"},null,512),[[h,l.value.name]]),e[24]||(e[24]=t("p",{class:"mt-1 text-xs text-gray-500"},"Unique identifier (alphanumeric, dashes, underscores)",-1))])):f("",!0),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700"},"Display Name",-1)),c(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.value.display_name=s),type:"text",required:"",class:"input mt-1",placeholder:"My Harbor Registry"},null,512),[[h,l.value.display_name]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700"},"URL",-1)),c(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.url=s),type:"url",required:"",class:"input mt-1",placeholder:"https://harbor.example.com"},null,512),[[h,l.value.url]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700"},"Registry/Project",-1)),c(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.registry=s),type:"text",required:"",class:"input mt-1",placeholder:"library"},null,512),[[h,l.value.registry]])]),t("div",Ne,[t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700"},"Username",-1)),c(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.username=s),type:"text",class:"input mt-1",placeholder:x.value==="edit"?"(unchanged)":"Optional"},null,8,Pe),[[h,l.value.username]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700"},"Password",-1)),c(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.password=s),type:"password",class:"input mt-1",placeholder:x.value==="edit"?"(unchanged)":"Optional"},null,8,qe),[[h,l.value.password]])])]),t("div",Ze,[t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-gray-700"},"Priority",-1)),c(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.priority=s),type:"number",class:"input mt-1",min:"0"},null,512),[[h,l.value.priority,void 0,{number:!0}]]),e[31]||(e[31]=t("p",{class:"mt-1 text-xs text-gray-500"},"Lower = higher priority",-1))]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-gray-700"},"Cache Isolation",-1)),c(t("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>l.value.cache_isolation=s),class:"input mt-1"},[...e[32]||(e[32]=[t("option",{value:"shared"},"Shared",-1),t("option",{value:"isolated"},"Isolated",-1)])],512),[[Q,l.value.cache_isolation]])])]),t("div",ze,[t("label",Ie,[c(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.value.enabled=s),type:"checkbox",class:"rounded"},null,512),[[T,l.value.enabled]]),e[34]||(e[34]=t("span",{class:"text-sm text-gray-700"},"Enabled",-1))]),t("label",Oe,[c(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>l.value.is_default=s),type:"checkbox",class:"rounded"},null,512),[[T,l.value.is_default]]),e[35]||(e[35]=t("span",{class:"text-sm text-gray-700"},"Default upstream",-1))]),t("label",Ge,[c(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>l.value.skip_tls_verify=s),type:"checkbox",class:"rounded"},null,512),[[T,l.value.skip_tls_verify]]),e[36]||(e[36]=t("span",{class:"text-sm text-gray-700"},"Skip TLS verify",-1))])]),t("div",Je,[t("button",{type:"button",onClick:P,disabled:j.value||!l.value.url||!l.value.registry,class:"btn btn-secondary flex items-center gap-2"},[m(u(te),{class:"h-4 w-4"}),b(" "+d(j.value?"Testing...":"Test Connection"),1)],8,Ke),y.value?(n(),r("div",{key:0,class:k(["mt-2 p-2 rounded text-sm",y.value.success?"bg-green-50 text-green-700":"bg-red-50 text-red-700"])},d(y.value.message),3)):f("",!0)]),t("div",Qe,[t("button",{type:"button",onClick:B,class:"btn btn-secondary"}," Cancel "),t("button",We,d(x.value==="create"?"Create":"Save"),1)])],32)])])])):f("",!0)]))]))}});export{st as default};
